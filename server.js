const express = require("express");
const mongoose = require("mongoose");
const cors = require("cors");
const helmet = require("helmet");
const cloudinary = require("cloudinary").v2;
require("dotenv").config();

const classRoutes = require("./routes/class");
const studentRoutes = require("./routes/student");
const teacherRoutes = require("./routes/teacher");
const adminRoutes = require("./routes/admin");

cloudinary.config({
  cloud_name: "dw3ap99ie",
  api_key: "821523511441267",
  api_secret: "gB05RfIeRoEEaWJE-Tfx710utvQ",
  secure: true,
});

const app = express();

app.use(cors());
app.use(helmet());
app.use(express.json());

app.use("/student", studentRoutes);
app.use("/teacher", teacherRoutes);
app.use("/class", classRoutes);
app.use("/admin", adminRoutes);

app.use((error, req, res, next) => {
  res.status(error.status).json({ message: error.message });
});

const port = process.env.PORT || 5000;

(async () => {
  try {
    await mongoose.connect(process.env.MONGO_URI);
    app.listen(port, () => console.log("Listening at 5000!"));
  } catch (error) {
    console.log(error);
  }
})();

// (async () => {
//   const result = await cloudinary.uploader.upload(
//     "data:image/jpeg;base64,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"
//   );
//   console.log(result);
// })();
